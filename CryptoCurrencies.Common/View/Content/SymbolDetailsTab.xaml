<local:ContentControlBase
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:CryptoCurrencies.Common.View.Content"
             xmlns:xamlExt="clr-namespace:CryptoCurrencies.Common.Extensions.XAML"
             xmlns:viewmodels="clr-namespace:CryptoCurrencies.Common.ViewModel"
             xmlns:modeldata="clr-namespace:CryptoCurrencies.Common.Model"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors" 
             x:TypeArguments="modeldata:SymbolDetailsModel" 
             xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts" 
             x:Class="CryptoCurrencies.Common.View.Content.SymbolDetailsTab"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             >

    <UserControl.Resources>
        <xamlExt:DISource Type="{x:Type viewmodels:SymbolDetailsViewModel}" x:Key="vm"/>
    </UserControl.Resources>
    <UserControl.DataContext>
        <Binding Source="{StaticResource vm}"/>
    </UserControl.DataContext>
    <Grid xamlExt:ScrollViewerExt.BlockScrollOverElement="{Binding ElementName=chartControl}">
        <ScrollViewer x:Name="rootView">
            <VirtualizingStackPanel Orientation="Vertical">
                <dxc:ChartControl
                    x:Name="chartControl"
                    IsDirectXSurfaceRendering="True"
                    Height="{DXBinding '@e(rootView).ActualHeight * 0.66'}">
                    <dxc:ChartControl.ToolTipOptions>
                        <dxc:ToolTipOptions />
                    </dxc:ChartControl.ToolTipOptions>
                    <dxc:ChartControl.Diagram>
                        <dxc:XYDiagram2D 
                            EnableAxisXNavigation="True"
                            DependentAxesYRange="True"
                            BorderThickness="0"
                            x:Name="Diagram">
                            <dxc:XYDiagram2D.AxisX>
                                <dxc:AxisX2D x:Name="mainAxisX">
                                    <dxc:AxisX2D.DateTimeScaleOptions>
                                        <dxc:ManualDateTimeScaleOptions
                                            AggregateFunction="None"
                                            MeasureUnit="{Binding Model.SelectedChartInterval.MeasureUnit}"
                                            MeasureUnitMultiplier="{Binding Model.SelectedChartInterval.MeasureUnitMultiplier}"
                                            SkipRangesWithoutPoints="True"
                                            />
                                    </dxc:AxisX2D.DateTimeScaleOptions>

                                    <dxc:AxisX2D.Label>
                                        <dxc:AxisLabel Visible="True" TextPattern="{}{0:dd/MM/yyyy}"/>
                                    </dxc:AxisX2D.Label>

                                    <dxc:AxisX2D.WholeRange>
                                        <dxc:Range  AutoSideMargins="False" />
                                    </dxc:AxisX2D.WholeRange>

                                    <dxc:AxisX2D.VisualRange>
                                        <dxc:Range 
                                            MinValue="{Binding Model.MinDateTimeVisualRange}" 
                                            MaxValue="{Binding Model.MaxDateTimeVisualRange}"/>
                                    </dxc:AxisX2D.VisualRange>
                                </dxc:AxisX2D>
                            </dxc:XYDiagram2D.AxisX>

                            <dxc:XYDiagram2D.AxisY>
                                <dxc:AxisY2D Interlaced="False" Visible="True" Alignment="Far">
                                    <dxc:AxisY2D.WholeRange>
                                        <dxc:Range
                                            SideMarginSizeUnit="AxisRangePercentage"
                                            EndSideMargin="40"/>
                                    </dxc:AxisY2D.WholeRange>
                                    <dxc:AxisY2D.VisualRange>
                                        <dxc:Range
                                            dxc:AxisY2D.AlwaysShowZeroLevel="False" 
                                            MinValue="{Binding Model.MinPriceVisualRange}"
                                            MaxValue="{Binding Model.MaxPriceVisualRange}"
                                        />
                                    </dxc:AxisY2D.VisualRange>
                                </dxc:AxisY2D>
                            </dxc:XYDiagram2D.AxisY>

                            <dxc:XYDiagram2D.DefaultPane>
                                <dxc:Pane x:Name="defaultPane" dxc:GridLayout.RowSpan="3" DomainBorderBrush="Transparent">
                                    <dxc:Pane.AxisXScrollBarOptions>
                                        <dxc:ScrollBarOptions Visible="False"/>
                                    </dxc:Pane.AxisXScrollBarOptions>
                                </dxc:Pane>
                            </dxc:XYDiagram2D.DefaultPane>

                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Scroll" Command="{Binding ChartHorizontalScrollCommand}" PassEventArgsToCommand="True"/>
                                <dxmvvm:EventToCommand EventName="Zoom" Command="{Binding ChartZoomCommand}" PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>

                            <dxc:CandleStickSeries2D
                                DataSource="{Binding Model.CandleStickData}"
                                ArgumentScaleType="DateTime"
                                ArgumentDataMember="OpenTime"
                                OpenValueDataMember="OpenPrice"
                                CloseValueDataMember="ClosePrice"
                                HighValueDataMember="HighPrice"
                                LowValueDataMember="LowPrice"
                
                                Brush="Green"
                                LabelsVisibility="False"
                                DisplayName="{Binding Model.SymbolData.Symbol}">

                                <dxc:CandleStickSeries2D.ReductionOptions>
                                    <dxc:ReductionStockOptions
                                        ColorMode="OpenToCloseValue"
                                        dxc:CandleStickSeries2D.FillMode="AlwaysFilled"
                                        Level="CloseValue"
                                        Brush="Red"
                                        Enabled="True"/>
                                </dxc:CandleStickSeries2D.ReductionOptions>

                                <dxc:CandleStickSeries2D.Model>
                                    <dxc:ThinCandleStick2DModel/>
                                </dxc:CandleStickSeries2D.Model>
                            </dxc:CandleStickSeries2D>
                        </dxc:XYDiagram2D>
                    </dxc:ChartControl.Diagram>
                </dxc:ChartControl>

                <ListView x:Name="listViewMarkets" ItemsSource="{Binding Model.Markets}" Height="{DXBinding '@e(rootView).ActualHeight'}">
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseDoubleClick">
                            <i:InvokeCommandAction Command="{Binding OpenExchangeCommand}" CommandParameter="{Binding SelectedItem, ElementName=listViewMarkets}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Width="150" DisplayMemberBinding="{Binding MarketName}"/>
                            <GridViewColumn DisplayMemberBinding="{Binding Price}"/>
                            <GridViewColumn Width="300" DisplayMemberBinding="{Binding PriceCurrency}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </VirtualizingStackPanel>
        </ScrollViewer>
    </Grid>
</local:ContentControlBase>
